<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GG's Encrypt & Decrypt Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: radial-gradient(ellipse at bottom, #0d0d1a 0%, #000010 100%);
      --text-color: #e0e7ff;
      --title-color: #c2f0ff;
      --input-bg: #1a1a2e;
      --input-border: #4a5568;
      --button-bg: #4dd0e1;
      --button-hover: #00bcd4;
      --output-border: #88ccff;
      --history-bg: rgba(26, 32, 44, 0.8);
      --history-border: #4a5568;
      --history-hover: rgba(74, 85, 104, 0.2);
      --history-operation-bg: #2d3748;
      --history-text: #cbd5e0;
    }

    body.light-theme {
      --bg-color: linear-gradient(to bottom, #f0f4f8 0%, #d9e2ec 100%);
      --text-color: #334155;
      --title-color: #0f172a;
      --input-bg: #ffffff;
      --input-border: #cbd5e0;
      --button-bg: #0ea5e9;
      --button-hover: #0284c7;
      --output-border: #0ea5e9;
      --history-bg: rgba(241, 245, 249, 0.9);
      --history-border: #cbd5e0;
      --history-hover: rgba(226, 232, 240, 0.7);
      --history-operation-bg: #e2e8f0;
      --history-text: #475569;
    }

    body {
      font-family: 'Orbitron', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
      overflow-x: hidden;
      position: relative;
      margin: 0;
      transition: all 0.3s ease;
    }
    
    #theme-container {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      display: flex;
      align-items: center;
    }
    
    #themeSelect {
      width: auto;
      padding: 8px;
      margin: 0;
      background-color: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
      border-radius: 8px;
      cursor: pointer;
    }
    
    h1 {
      text-align: center;
      font-size: 3em;
      margin-bottom: 30px;
      padding-top: 20px;
      color: var(--title-color);
      text-shadow: 0 0 10px #88ccff, 0 0 20px #88ccff;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    label, select, textarea, input, button {
      display: block;
      width: 100%;
      margin: 15px 0;
      padding: 15px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      background-color: var(--input-bg);
      color: var(--text-color);
      box-shadow: 0 0 5px var(--input-border);
      transition: all 0.3s ease;
    }
    
    input[type="file"] {
      padding: 10px;
      background-color: var(--input-bg);
    }
    
    button {
      background-color: var(--button-bg);
      border: none;
      cursor: pointer;
      transition: background-color 0.3s, box-shadow 0.3s;
      margin: 20px 0;
    }
    
    button:hover {
      background-color: var(--button-hover);
      box-shadow: 0 0 10px var(--button-hover);
    }
    
    #output {
      white-space: pre-wrap;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      margin: 20px 0;
      border: 1px dashed var(--output-border);
      border-radius: 8px;
      color: var(--text-color);
      min-height: 100px;
    }
    
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: sparkle 1.5s ease-in-out infinite;
      opacity: 0;
      box-shadow: 0 0 6px 2px white;
      pointer-events: none;
      z-index: 0;
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.4); }
    }
    
    /* History feature styles */
    #historyContainer {
      margin-top: 40px;
      background: var(--history-bg);
      border-radius: 8px;
      padding: 20px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--history-border);
    }
    
    .history-item {
      border-bottom: 1px solid var(--history-border);
      padding: 15px 0;
      margin-bottom: 15px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .history-item:hover {
      background-color: var(--history-hover);
    }
    
    .history-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .history-algorithm {
      color: var(--button-bg);
      font-weight: bold;
    }
    
    .history-time {
      color: var(--history-text);
      font-size: 0.9em;
    }
    
    .history-operation {
      background-color: var(--history-operation-bg);
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
      margin-right: 10px;
      font-size: 0.9em;
    }
    
    .history-preview {
      color: var(--history-text);
      font-size: 0.9em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .history-buttons {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    
    .history-buttons button {
      padding: 8px;
      font-size: 0.8em;
      width: auto;
      margin: 5px 0;
    }
    
    .history-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
    }
    
    #historyToggleBtn {
      width: auto;
      padding: 8px 15px;
    }
    
    .history-count {
      background-color: var(--history-operation-bg);
      padding: 5px 10px;
      border-radius: 10px;
      font-size: 0.9em;
    }
    
    /* Animation for history panel */
    .slide-in {
      animation: slideIn 0.3s forwards;
    }
    
    .slide-out {
      animation: slideOut 0.3s forwards;
    }
    
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes slideOut {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(-20px); opacity: 0; }
    }
    
    .glow-input {
      box-shadow: 0 0 10px var(--button-hover) !important;
      border-color: var(--button-hover) !important;
    }
    
    .action-buttons {
      display: flex;
      gap: 20px;
    }
    
    .action-buttons button {
      flex: 1;
    }
    
    h3 {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div id="theme-container">
    <select id="themeSelect" onchange="changeTheme(this.value)">
      <option value="dark">Dark Theme</option>
      <option value="light">Light Theme</option>
    </select>
  </div>
  
  <div class="container">
    <h1>ðŸŒŒ GG's Encrypt and Decrypt Tool</h1>
  
    <label for="algorithmSelect">Choose an Algorithm:</label>
    <select id="algorithmSelect">
      <option value="caesar">Caesar Cipher</option>
      <option value="atbash">Atbash Cipher</option>
      <option value="vigenere">VigenÃ¨re Cipher</option>
      <option value="xor">XOR Cipher</option>
      <option value="aes">Simplified AES</option>
      <option value="rsa">Simplified RSA</option>
    </select>
  
    <div id="textInputArea">
      <label for="inputText">Enter your text:</label>
      <textarea id="inputText" rows="6" placeholder="Enter your text here..."></textarea>
  
      <div id="fileInputArea">
        <label for="uploadFileInput">Upload a .txt file (optional):</label>
        <input type="file" id="uploadFileInput" accept=".txt" onchange="handleFileUpload(event)">
      </div>
    </div>
  
    <div class="action-buttons">
      <button onclick="handleEncrypt()">Encrypt</button>
      <button onclick="handleDecrypt()">Decrypt</button>
    </div>
  
    <h3>Output:</h3>
    <div id="output"></div>
    <button onclick="downloadOutput()">Download Result</button>
  
    <!-- History Feature UI -->
    <div class="history-toggle">
      <h3>History</h3>
      <span class="history-count" id="historyCount">0 items</span>
      <button id="historyToggleBtn" onclick="toggleHistory()">Show History</button>
    </div>
    
    <div id="historyContainer" style="display: none;">
      <div id="historyList">
        <!-- History items will be populated here -->
      </div>
      <button onclick="clearHistory()" style="margin-top: 20px; background-color: #e53e3e;">Clear History</button>
    </div>
  </div>

  <script>
    // Initialize history array from localStorage or create empty array
    let operationHistory = JSON.parse(localStorage.getItem('encryptionHistory')) || [];
    
    // Check for saved theme preference
    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.getElementById('themeSelect').value = savedTheme;
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
      }
    });
    
    // Theme Change Function
    function changeTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light-theme');
      } else {
        document.body.classList.remove('light-theme');
      }
      localStorage.setItem('theme', theme);
    }
    
    // Update history count badge
    function updateHistoryCount() {
      document.getElementById('historyCount').textContent = `${operationHistory.length} items`;
    }
    
    // Call this on page load
    updateHistoryCount();
    
    function handleEncrypt() {
      clearVisuals();
      addStars(30);
      process('encrypt');
    }

    function handleDecrypt() {
      clearVisuals();
      addStars(60);
      process('decrypt');
    }

    function process(mode) {
      const algorithm = document.getElementById('algorithmSelect').value;
      const inputText = document.getElementById('inputText').value;

      if (!inputText.trim()) {
        document.getElementById('output').textContent = "Please enter some text to process.";
        return;
      }

      let result = '';
      switch (algorithm) {
        case 'caesar': result = caesarCipher(inputText, mode === 'encrypt' ? 3 : -3); break;
        case 'atbash': result = atbashCipher(inputText); break;
        case 'vigenere': result = vigenereCipher(inputText, 'KEY', mode === 'encrypt'); break;
        case 'xor': result = xorCipher(inputText, 'K'); break;
        case 'aes': result = aesCipher(inputText, 'SIMPLEKEY', mode === 'encrypt'); break;
        case 'rsa': result = rsaCipher(inputText, mode === 'encrypt'); break;
        default: result = '[Unsupported algorithm]';
      }
      
      document.getElementById('output').textContent = result;
      
      // Add to history
      addToHistory(algorithm, mode, inputText, result);
    }

    function caesarCipher(str, shift) {
      return str.split('').map(char => {
        const code = char.charCodeAt(0);
        if (char >= 'a' && char <= 'z')
          return String.fromCharCode(((code - 97 + shift + 26) % 26) + 97);
        if (char >= 'A' && char <= 'Z')
          return String.fromCharCode(((code - 65 + shift + 26) % 26) + 65);
        return char;
      }).join('');
    }

    function atbashCipher(str) {
      return str.split('').map(char => {
        if (char >= 'a' && char <= 'z')
          return String.fromCharCode(122 - (char.charCodeAt(0) - 97));
        if (char >= 'A' && char <= 'Z')
          return String.fromCharCode(90 - (char.charCodeAt(0) - 65));
        return char;
      }).join('');
    }

    function vigenereCipher(text, key, encrypt = true) {
      let result = '';
      key = key.toUpperCase();
      let keyIndex = 0;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const isUpper = char >= 'A' && char <= 'Z';
        const isLower = char >= 'a' && char <= 'z';

        if (isUpper || isLower) {
          const base = isUpper ? 65 : 97;
          const keyChar = key[keyIndex % key.length];
          const shift = keyChar.charCodeAt(0) - 65;
          const charCode = char.charCodeAt(0) - base;
          const newChar = encrypt
            ? (charCode + shift) % 26
            : (charCode - shift + 26) % 26;
          result += String.fromCharCode(newChar + base);
          keyIndex++;
        } else {
          result += char;
        }
      }
      return result;
    }

    function xorCipher(text, key) {
      return text.split('').map((char, i) =>
        String.fromCharCode(char.charCodeAt(0) ^ key.charCodeAt(i % key.length))
      ).join('');
    }

    function aesCipher(text, key, encrypt = true) {
      const shift = encrypt ? key.length : -key.length;
      return text.split('').map(char =>
        String.fromCharCode(char.charCodeAt(0) + shift)
      ).join('');
    }

    function rsaCipher(text, encrypt = true) {
      return text.split('').map(char => {
        const code = char.charCodeAt(0);
        return encrypt
          ? String.fromCharCode((code * code) % 256)
          : String.fromCharCode(Math.round(Math.sqrt(code)));
      }).join('');
    }

    function downloadOutput() {
      const blob = new Blob([document.getElementById('output').textContent], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'result.txt';
      link.click();
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('inputText').value = e.target.result;
        };
        reader.readAsText(file);
      }
    }

    function addStars(count) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        star.style.top = Math.random() * window.innerHeight + 'px';
        star.style.left = Math.random() * window.innerWidth + 'px';
        document.body.appendChild(star);
        setTimeout(() => star.remove(), 2000);
      }
    }

    function clearVisuals() {
      document.querySelectorAll('.star').forEach(el => el.remove());
    }
    
    // History Functions
    function addToHistory(algorithm, operation, inputText, result) {
      const historyItem = {
        id: Date.now(),
        timestamp: new Date().toLocaleString(),
        algorithm: algorithm,
        operation: operation,
        input: inputText,
        output: result
      };
      
      // Add to beginning of array (newest first)
      operationHistory.unshift(historyItem);
      
      // Limit history to 50 items
      if (operationHistory.length > 50) {
        operationHistory = operationHistory.slice(0, 50);
      }
      
      // Save to localStorage
      localStorage.setItem('encryptionHistory', JSON.stringify(operationHistory));
      
      // Update UI
      updateHistoryCount();
      renderHistory();
    }
    
    function renderHistory() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      if (operationHistory.length === 0) {
        historyList.innerHTML = '<p>No history yet. Encrypt or decrypt some text to see your history.</p>';
        return;
      }
      
      operationHistory.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.id = `history-${item.id}`;
        
        const operationLabel = item.operation === 'encrypt' ? 'Encrypted' : 'Decrypted';
        
        historyItem.innerHTML = `
          <div class="history-item-header">
            <span class="history-algorithm">${item.algorithm.toUpperCase()}</span>
            <span class="history-time">${item.timestamp}</span>
          </div>
          <div>
            <span class="history-operation">${operationLabel}</span>
            <span class="history-preview">${item.input.substring(0, 30)}${item.input.length > 30 ? '...' : ''}</span>
          </div>
          <div class="history-buttons">
            <button onclick="loadHistoryItem(${item.id})">Load Input</button>
            <button onclick="loadHistoryOutput(${item.id})">Load Output</button>
          </div>
        `;
        
        historyList.appendChild(historyItem);
      });
    }
    
    function toggleHistory() {
      const historyContainer = document.getElementById('historyContainer');
      const toggleBtn = document.getElementById('historyToggleBtn');
      
      if (historyContainer.style.display === 'none') {
        historyContainer.style.display = 'block';
        historyContainer.classList.add('slide-in');
        toggleBtn.textContent = 'Hide History';
        renderHistory();
      } else {
        historyContainer.classList.remove('slide-in');
        historyContainer.classList.add('slide-out');
        setTimeout(() => {
          historyContainer.style.display = 'none';
          historyContainer.classList.remove('slide-out');
        }, 300);
        toggleBtn.textContent = 'Show History';
      }
    }
    
    function loadHistoryItem(id) {
      const item = operationHistory.find(item => item.id === id);
      if (item) {
        const inputTextArea = document.getElementById('inputText');
        inputTextArea.value = item.input;
        
        // Set algorithm dropdown
        document.getElementById('algorithmSelect').value = item.algorithm;
        
        // Highlight input field briefly
        inputTextArea.classList.add('glow-input');
        setTimeout(() => {
          inputTextArea.classList.remove('glow-input');
        }, 1000);
        
        // Scroll to input area
        inputTextArea.scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    function loadHistoryOutput(id) {
      const item = operationHistory.find(item => item.id === id);
      if (item) {
        const inputTextArea = document.getElementById('inputText');
        inputTextArea.value = item.output;
        
        // Set algorithm dropdown
        document.getElementById('algorithmSelect').value = item.algorithm;
        
        // Highlight input field briefly
        inputTextArea.classList.add('glow-input');
        setTimeout(() => {
          inputTextArea.classList.remove('glow-input');
        }, 1000);
        
        // Scroll to input area
        inputTextArea.scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    function clearHistory() {
      if (confirm('Are you sure you want to clear your history? This cannot be undone.')) {
        operationHistory = [];
        localStorage.removeItem('encryptionHistory');
        updateHistoryCount();
        renderHistory();
      }
    }
  </script>
</body>
</html>
